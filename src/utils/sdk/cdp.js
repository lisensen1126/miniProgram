!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cdp=t():e.cdp=t()}(window,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=n(1),r=n(2),s=n(3),u=n(4),a=n(6),c=(o=a)&&o.__esModule?o:{default:o};var f=require('./cdp_conf.js'),l=new i.Http(f),p=new s.Storage,h=new u.Queue(l,p,f);var y=App;App=function(e){f.isReport&&(f.isLogin=!1,f.user={},f.system=new r.System,f.system.appid=f.appId,l.getToken(c.default.token).then(function(e){l.get(c.default.getSessionId,{}).then(function(e){0===parseInt(e.code)&&(f.sessionId=e.data.sessionId)})}));return["onLaunch","onShow","onHide","onError"].map(function(t){!function(e,t){var n=e[t];e[t]=function(e){"function"==typeof n&&(console.log("监听函数名----"+t,"----相关参数----"+JSON.stringify(e)),n.call(this,e))}}(e,t)}),e[f.name]={track:function(e,t){var n=this;if(f.sessionId){arguments.length>1&&"login"===t&&(f.user=e.customize,f.isLogin=!0);var o={eventType:e.eventType,isLogin:f.isLogin};if(o.device=f.system,o.user=f.user,o.biz=e.biz,o.customize=e.customize,!o.biz.sourceUrl){var i=getCurrentPages();i.length>0?o.biz.sourceUrl=i[i.length-1].route:o.biz.sourceUrl=""}var r=p.get(),s=null,u="";if(r.length>0){u=c.default.batchReport,(s=r).push(o);var a=function(e,t){if(e.length>10){t.push(e.slice(0,10));var n=e.slice(10,e.length);n.length>10?this.arrSlice(n,t):t.push(n)}else t.push(e);return t}(s,[]);p.set([]);for(var l=0;l<a.length;l++){var y=a[l];h.enQueue({apiUrl:u,item:y})}}else u=c.default.report,s=o,h.enQueue({apiUrl:u,params:s})}else setTimeout(function(){n.track(e,t)},2e3)},sessionId:function(){return f.sessionId}},y(e)},t.default=App},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Http=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t}return o(e,[{key:"getToken",value:function(e){var t=this,n={appKey:this.config.appKey,secretKey:this.config.secretKey};return new Promise(function(o,i){t.config.Authorization="",t.post(e,n).then(function(e){0===parseInt(e.code)&&(t.config.Authorization=e.data.access_token,o(e.data))})})}},{key:"request",value:function(e,t,n){var o=this,i="";e&&(i=this.config.serverUrl+e);var r={"content-type":"application/json"};return this.config.Authorization&&(r.Authorization="bearer "+this.config.Authorization),new Promise(function(s,u){wx.request({url:i,method:t,data:n,header:r,success:function(i){20002===i.data.code||20003===i.data.code?o.getToken("/auth/get_access_token").then(function(i){o.request(e,t,n)}):s(i.data)},fail:function(e){u(e.data)},complete:function(e){u(e.data)}})})}},{key:"post",value:function(e,t,n){return this.request(e,"POST",t,n)}},{key:"get",value:function(e,t,n){return this.request(e,"GET",t,n)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.System=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.os="",this.osVersion="",this.manufacturer="",this.model="",this.screenWidth="",this.screenHeight="",this.networkType="",this.longitude="",this.latitude="",this.userAgent="",this.imei="",this.sid="",this.sdkVersion="",this.sdkType="",this.appid="",this.SystemInfo(),this.NetworkType()}return o(e,[{key:"SystemInfo",value:function(){var e=this;wx.getSystemInfo({success:function(t){e.os=t.system.split(" ")[0],e.osVersion=t.system.split(" ")[1],e.manufacturer=t.brand,e.model=t.model,e.screenWidth=Number(t.screenWidth),e.screenHeight=Number(t.screenHeight)}})}},{key:"NetworkType",value:function(){var e=this;wx.getNetworkType({success:function(t){e.networkType=t.networkType}})}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Storage=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),0===this.get().length&&this.set("")}return o(e,[{key:"set",value:function(e){e=e||[];try{wx.setStorageSync("ead",e)}catch(e){console.log("setError",e)}}},{key:"get",value:function(){try{return wx.getStorageSync("ead")}catch(e){return[]}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(5);t.Queue=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.http=t,this.storage=n,this.logger=new i.Logger(o),this.config=o,this.items=[],this.queueStatus=!1}return o(e,[{key:"exeRequest",value:function(){this.size()>0?this.config.isReport&&this.doRequest(this.front()):this.queueStatus=!1}},{key:"resultHand",value:function(e,t,n){if(this.logger.info("请求结果----",JSON.stringify(e)),this.deQueue(),this.logger.info("当前队列结果----数量："+this.size()+"----内容："+JSON.stringify(this.items)),n){var o=this.storage.get();o.length>0?this.storage.set(o.concat(t)):this.storage.set(t),this.logger.info("当前缓存数据----",JSON.stringify(this.storage.get()))}this.exeRequest()}},{key:"doRequest",value:function(e){var t=this;this.logger.info("请求参数----",JSON.stringify(e.params));var n={sessionId:t.config.sessionId,appkey:t.config.appKey,properties:e.params};this.queueStatus=!0,this.http.post(e.apiUrl,n).then(function(n){0===parseInt(n.code)?t.resultHand(n,e.params,!1):t.resultHand(n,e.params,!0)},function(n){t.resultHand(n,e.params.true)})}},{key:"enQueue",value:function(e){this.logger.info("向队列添加新数据----",JSON.stringify(e)),this.items.push(e),this.size()>1&&this.queueStatus||this.exeRequest()}},{key:"deQueue",value:function(){return this.items.shift()}},{key:"front",value:function(){return this.items[0]}},{key:"isEmpty",value:function(){return 0===this.items.length}},{key:"size",value:function(){return this.items.length}},{key:"clear",value:function(){this.items=[]}},{key:"print",value:function(){this.logger.info(this.items)}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();t.Logger=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t}return i(e,[{key:"info",value:function(){if(this.config.showLog&&"object"==("undefined"==typeof console?"undefined":o(console))&&console.log)try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={token:"/auth/get_access_token",getSessionId:"/uaa/miniapp/v1/sys/get_session_id",batchReport:"/report/miniapp/v1/event/batch_report",report:"/report/miniapp/v1/event/report"}}])});